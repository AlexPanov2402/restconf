# RESTCONF Server on FastAPI

–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç: —É—á–µ–±–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è **RESTCONF-—Å–µ—Ä–≤–µ—Ä–∞** –Ω–∞ –±–∞–∑–µ [FastAPI](https://fastapi.tiangolo.com/) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π YANG-–º–æ–¥–µ–ª–µ–π.  
–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å [`jukebox.yang`](yang_modules/jukebox.yang) –∏–∑ [RFC 8040](https://datatracker.ietf.org/doc/html/rfc8040).

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –†–∞–±–æ—Ç–∞ –ø–æ RESTCONF API —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º YANG-–º–æ–¥–µ–ª–µ–π.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π:
  - `GET`: –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
  - `PATCH`: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
  - `POST`: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π RPC.
- Swagger UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `/docs`.

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ Poetry)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Poetry, –µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
   ```bash
   curl -sSL https://install.python-poetry.org | python3 -
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
poetry install
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
poetry run uvicorn app.server:app --reload --host 0.0.0.0 --port 8000
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

Swagger UI: http://127.0.0.1:8000/docs

OpenAPI: http://127.0.0.1:8000/openapi.json

–í Docker
–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
docker compose build
docker compose up -d
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω:

–õ–æ–∫–∞–ª—å–Ω–æ: http://127.0.0.1:8000/docs

–ü–æ —Å–µ—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –≤–Ω–µ—à–Ω–µ–º IP): http://<SERVER_IP>:8000/docs

‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç –≤ firewall:

bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
sudo ufw allow 8000/tcp
üì° –ü—Ä–∏–º–µ—Ä—ã HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
1. GET: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ datastore
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
curl http://127.0.0.1:8000/restconf/data
2. GET: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —É–∑–µ–ª –ø–æ –ø—É—Ç–∏ /restconf/data/<path>
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
curl http://127.0.0.1:8000/restconf/data/jukebox/library/album
3. PATCH: –ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –∞–ª—å–±–æ–º)
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
curl -X PATCH http://127.0.0.1:8000/restconf/data/jukebox/library \
  -H "Content-Type: application/json" \
  -d '{"album":[{"name":"BestOf","artist":"Queen"}]}'
4. POST: –í—ã–∑–≤–∞—Ç—å RPC-–º–µ—Ç–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–µ—Å–Ω—é)
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
curl -X POST http://127.0.0.1:8000/restconf/operations/play-song \
  -H "Content-Type: application/json" \
  -d '{"song": "Bohemian Rhapsody"}'
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
GET –Ω–∞ –∫–æ—Ä–µ–Ω—å datastore: /restconf/data –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å—ë —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —É–∑–µ–ª –ø–æ –ø—É—Ç–∏ /restconf/data/<path>.

–ü—Ä–∏–º–µ—Ä: GET /restconf/data/jukebox/library –≤–µ—Ä–Ω—ë—Ç –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∞–ª—å–±–æ–º–æ–≤.

PATCH: –ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º GET.

–ü—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–ª—å–±–æ–º–∞ —á–µ—Ä–µ–∑ PATCH –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤ GET.

POST –Ω–∞ RPC-—ç–Ω–¥–ø–æ–∏–Ω—Ç: –í—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–ü—Ä–∏–º–µ—Ä: POST /restconf/operations/play-song –≤–µ—Ä–Ω—ë—Ç —Å—Ç–∞—Ç—É—Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã.

üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
Python 3.11

FastAPI + Uvicorn

Poetry (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏)

Docker + docker-compose

pyang, yangson (—Ä–∞–±–æ—Ç–∞ —Å YANG)

üîÆ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è
–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL.

–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis.

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (OAuth2/JWT).

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ YANG-–º–æ–¥–µ–ª–∏.

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (pytest) –∏ CI.